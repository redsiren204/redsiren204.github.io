<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Cross compiler – TamTV's blog</title> <meta name="description" content="Writing code everyday..."> <meta name="keywords" content="sample post, images, test"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://redsiren204.github.io/assets/img/logo.png"> <meta name="twitter:title" content="Cross compiler"> <meta name="twitter:description" content="Tìm hiểu về Cross compiler / Toolchain"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Cross compiler"> <meta property="og:description" content="Tìm hiểu về Cross compiler / Toolchain"> <meta property="og:url" content="https://redsiren204.github.io/cross-compiler/"> <meta property="og:site_name" content="TamTV's blog"> <meta property="og:image" content="https://redsiren204.github.io/assets/img/logo.png"> <link rel="canonical" href="https://redsiren204.github.io/cross-compiler/"> <link href="https://redsiren204.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="TamTV's blog Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://redsiren204.github.io/assets/css/main.css"> <!-- JS --> <script src="https://redsiren204.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://redsiren204.github.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://redsiren204.github.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://redsiren204.github.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://redsiren204.github.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://redsiren204.github.io/favicon.png"> <link rel="shortcut icon" href="https://redsiren204.github.io/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(https://redsiren204.github.io/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://redsiren204.github.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://redsiren204.github.io/assets/img/logo.png" alt="TamTV's blog photo" class="author-photo"> <h4>TamTV's blog</h4> <p>Writing code everyday...</p> </li> <li><a href="https://redsiren204.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:redsiren204@gmail.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://facebook.com/redsiren204" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="http://instagram.com/redsiren204" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-instagram"></i> Instagram</a> </li> <li> <a href="http://github.com/https://github.com/redsiren204" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://redsiren204.github.io/posts/">All Posts</a></li> <li><a href="https://redsiren204.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://redsiren204.github.io/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Cross compiler</h1> <h4>27 Jun 2017</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~2 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://redsiren204.github.io/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h3 id="Định-nghĩa-trình-biên-dịch">Định nghĩa trình biên dịch</h3> <blockquote> <p>Trình biên dịch, còn gọi là phần mềm biên dịch, compiler, là một chương trình máy tính làm công việc dịch một chuỗi các câu lệnh được viết bằng một ngôn ngữ lập trình (gọi là ngôn ngữ nguồn hay mã nguồn), thành một chương trình tương đương nhưng ở dưới dạng một ngôn ngữ máy tính mới (gọi là ngôn ngữ đích) và thường là ngôn ngữ ở cấp thấp hơn, như ngôn ngữ máy. Chương trình mới được dịch này gọi mã đối tượng.</p> </blockquote> <h3 id="quá-trình-biên-dịch">Quá trình biên dịch</h3> <p>Ví dụ có chương trình sau được lưu dưới tên mytest.c</p> <figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;stdio.h&gt;
#include &lt;math.h&gt;
#define PI 3.14
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">PI</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Value cos(%f) = %f </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure> <p>Trong chương trình có sử dụng thư viện math.h. Trong quá trình linker sẽ tiến hành lấy mã của hàm printf() trong thư viện để kết hợp với mã thông thường khác.</p> <figure> <a href="https://raw.githubusercontent.com/redsiren204/redsiren204.github.io/master/resources/cross-compiler/CompilationProcess.png"><img src="https://raw.githubusercontent.com/redsiren204/redsiren204.github.io/master/resources/cross-compiler/CompilationProcess.png" width="400"></a> <figcaption><a href="https://raw.githubusercontent.com/redsiren204/redsiren204.github.io/master/resources/cross-compiler/CompilationProcess.png" title="Quá trình biên dịch">Quá trình biên dịch</a>.</figcaption> </figure> <h3 id="cross-compiler--toolchain-là-gì">Cross compiler / Toolchain là gì?</h3> <p>Có thể hiểu Cross compiler hay còn gọi là Toolchain như sau: Một source code được viết trên máy tính chạy chíp Intel (x86 platform), thông qua một cross compiler sẽ cho ra file nhị phân (mã máy) có khả năng chạy được trên một nên tảng chip khác là ARM (ARM platform). Trên hình native compiler là trình biên dịch để tạo ra file nhị phân chạy trên chính máy tính đang dùng để viết source code.</p> <figure> <a href="https://raw.githubusercontent.com/redsiren204/redsiren204.github.io/master/resources/cross-compiler/cross-compile.png"><img src="https://raw.githubusercontent.com/redsiren204/redsiren204.github.io/master/resources/cross-compiler/cross-compile.png"></a> </figure> <h3 id="hệ-thống-cross-compiler">Hệ thống Cross compiler</h3> <p>Quá trình tạo và sử dụng Toolchain gồm 3 thành phần:</p> <figure> <a href="https://raw.githubusercontent.com/redsiren204/redsiren204.github.io/master/resources/cross-compiler/build-gcc-cross-compiler.png"><img src="https://raw.githubusercontent.com/redsiren204/redsiren204.github.io/master/resources/cross-compiler/build-gcc-cross-compiler.png"></a> </figure> <ul> <li>Build System: Hệ thống/platform tạo ra toolchain</li> <li>Host System: Hệ thống chạy chương trình toolchain để compile source của chương trình ứng dụng.</li> <li>Target: Là hệ thống chạy các chương trình do hệ thống host tạo ra.</li> </ul> <h3 id="cách-sử-dụng-cross-compiler-trên-một-hệ-thống-build-với-poky">Cách sử dụng cross compiler trên một hệ thống build với poky</h3> <ul> <li>Chỉnh sửa sdk, thêm các gói cần thiết dùng để compile source. Ví dụ:</li> </ul> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="gp">$ </span><span class="o">{</span>path<span class="o">}</span>/package-core-standalone-sdk-target.bbappend
RDEPENDS_<span class="k">${</span><span class="nv">PN</span><span class="k">}</span> +<span class="o">=</span> <span class="s2">"</span><span class="se">\</span><span class="s2">
linux-libc-headers-base-dev </span><span class="se">\</span><span class="s2">
tzcslib-dev </span><span class="se">\</span><span class="s2">
libtzcs-security-dev </span><span class="se">\</span><span class="s2">
gtk+-dev </span><span class="se">\</span><span class="s2">
"</span></code></pre></figure> <ul> <li>Build meta-toolchain sau khi chỉnh sửa sdk bằng poky:</li> </ul> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="gp">$ </span>bitbake meta-toolchain</code></pre></figure> <ul> <li>Copy sdk sang máy host để cài đặt:</li> </ul> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="gp">$ </span>cp debian-eglibc-x86_64-meta-toolchain-x86_64-toolchain-8.0.sh &lt;host_machine&gt;</code></pre></figure> <ul> <li>Run script để cài đặt toolchain trên máy host. Script này sẽ set lại biến PATH để sử dụng build source</li> </ul> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="gp">$ </span><span class="nb">source</span> /opt/debian/8.0/environment-setup-x86_64-debian-linux</code></pre></figure> <ul> <li>Cuối cùng sử dụng ${CC} thay vì gcc trên máy host để compiler source:</li> </ul> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="gp">$ </span><span class="k">${</span><span class="nv">CC</span><span class="k">}</span> -g abc.c -o  -lpthr -lX11 -ltzcs -ltzcs-s <span class="sb">`</span>pkg-config --cflags --libs gtk+-2.0<span class="sb">`</span></code></pre></figure> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://redsiren204.github.io/tags/#sample%20post" title="Pages tagged sample post" class="tag"><span class="term">sample post</span></a><a href="https://redsiren204.github.io/tags/#images" title="Pages tagged images" class="tag"><span class="term">images</span></a><a href="https://redsiren204.github.io/tags/#test" title="Pages tagged test" class="tag"><span class="term">test</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://redsiren204.github.io/cross-compiler/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=https://redsiren204.github.io/cross-compiler/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://redsiren204.github.io/cross-compiler/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="https://redsiren204.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://redsiren204.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://redsiren204.github.io/assets/js/jquery.goup.min.js"></script> <script src="https://redsiren204.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://redsiren204.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://redsiren204.github.io/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'taylantatli'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
