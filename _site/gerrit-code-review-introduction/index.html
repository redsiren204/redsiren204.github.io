<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Gerit code review - Introduction – TamTV's blog</title> <meta name="description" content="Writing code everyday..."> <meta name="keywords" content="Gerrit, review, introduction"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://redsiren204.github.io/assets/img/logo.png"> <meta name="twitter:title" content="Gerit code review - Introduction"> <meta name="twitter:description" content="Giới thiệu về Gerrit code review"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Gerit code review - Introduction"> <meta property="og:description" content="Giới thiệu về Gerrit code review"> <meta property="og:url" content="https://redsiren204.github.io/gerrit-code-review-introduction/"> <meta property="og:site_name" content="TamTV's blog"> <meta property="og:image" content="https://redsiren204.github.io/assets/img/logo.png"> <link rel="canonical" href="https://redsiren204.github.io/gerrit-code-review-introduction/"> <link href="https://redsiren204.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="TamTV's blog Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://redsiren204.github.io/assets/css/main.css"> <!-- JS --> <script src="https://redsiren204.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://redsiren204.github.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://redsiren204.github.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://redsiren204.github.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://redsiren204.github.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://redsiren204.github.io/favicon.png"> <link rel="shortcut icon" href="https://redsiren204.github.io/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(https://redsiren204.github.io/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://redsiren204.github.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://redsiren204.github.io/assets/img/logo.png" alt="TamTV's blog photo" class="author-photo"> <h4>TamTV's blog</h4> <p>Writing code everyday...</p> </li> <li><a href="https://redsiren204.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:redsiren204@gmail.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://facebook.com/redsiren204" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="http://instagram.com/redsiren204" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-instagram"></i> Instagram</a> </li> <li> <a href="http://github.com/https://github.com/redsiren204" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://redsiren204.github.io/posts/">All Posts</a></li> <li><a href="https://redsiren204.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://redsiren204.github.io/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Gerit code review - Introduction</h1> <h4>28 Jun 2017</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~5 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://redsiren204.github.io/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>Các developer đã quen với các host version control như <code class="highlighter-rouge">Github</code>, <code class="highlighter-rouge">Bitbucket</code>, <code class="highlighter-rouge">Gitlab</code>, <code class="highlighter-rouge">Google source</code>… Bài viết này giới thiệu về một công cụ quản lý và review source code cực hữu hiệu, tuy không còn mới lạ nhưng cũng là cái tên ít được nhắc đến - đó là Gerrit.</p> <h1 id="index">Index</h1> <ul> <li>Part 1 - Introduction</li> <li>Part 2 - Cài đặt, cấu hình Gerrit và authentication</li> <li>Part 3 - Tích hợp CI / CD</li> </ul> <h2 id="gerrit-là-gì">Gerrit là gì?</h2> <p>Gerrit là một công cụ hỗ trợ quản lý và review source code dựa trên nền tảng web, sử dụng git làm version control, được phát triển tại Google bởi Shawn Pearce trong quá trình phát triển dự án Android. Gerrit phiên bản 2.x được viết bằng Java trên nền J2EE servlet container. Gerrit là open source, nó hoàn toàn free và bạn có thể sử dụng nó làm công cụ quản lý và review source code cho team của mình.</p> <p>Gerrit được thiết kế để cung cấp một framework cho review mọi commit trước khi nó được chấp nhận vào source code chính thức. Những thay đổi được upload lên Gerrit nhưng không thực sự trở thành một chỉnh sửa của dự án cho đến khi chúng được review và chấp nhận.</p> <p>Gerrit không đơn thuần chỉ là công cụ review mà nó còn có thể sử dụng để xây dựng một server quản lý source code giống như github, gitbuckit.</p> <p>Những lý do mà bạn nên sử dụng Gerrit:</p> <ol> <li>Bạn có thể dễ dàng tìm lỗi trong thay đổi của commit</li> <li>Bạn có thể làm việc với Gerrit, nếu bạn có Git client, không cần cài đặt thêm bất kỳ Gerrit client nào</li> <li>Gerrit có thể được sử dụng như một trung gian giữa các developers và git repositories.</li> </ol> <p>Home page : https://www.gerritcodereview.com/</p> <h2 id="gerrit-tổ-chức">Gerrit tổ chức</h2> <p>Gerrit sử dụng <code class="highlighter-rouge">Git</code> làm version control, nó xây dựng một khối repository - nơi lưu trữ main source (<code class="highlighter-rouge">Authoritative Repository</code>) và các commit của developers cần được review từ phía reviewers (<code class="highlighter-rouge">Pending Changes</code>).</p> <p>Các developers sẽ Fetch source từ <code class="highlighter-rouge">Authoritative Repository</code>. Mỗi khi hoàn thành một task/change, thay vì push vào repository này, họ phải push vào khối <code class="highlighter-rouge">Pending Changes</code>. Điều này đảm bảo rằng mọi commit cần được <code class="highlighter-rouge">Approve</code> từ <code class="highlighter-rouge">Reviewer</code> (việc push vào <code class="highlighter-rouge">Authoritative Repository</code> chỉ khi có permission đặc biệt). Một khi change đã được approved, user có permission đặc biệt này có thể submit để merge change sang <code class="highlighter-rouge">Authoritative repository</code>.</p> <p>Trong một vài tổ chức team khác nhau, các commit pending changes này cũng có thể được auto verify bởi <code class="highlighter-rouge">CI Build Server</code> (eg : Jenkins) trước khi thực hiện verify bởi yếu tố con người (Reviewer) - điều này giúp cho developer và reviewer phát hiện được lỗi sớm nhất.</p> <h2 id="vòng-đời-và-các-thay-đổi-của-change">Vòng đời và các thay đổi của Change</h2> <p>Lấy ví dụ, chúng ta giả sử Gerrit server được chạy trên một server là 192.123.99.7 với HTTP interface trên cổng 8000 và SSH interface trên cổng 29418. Dự án chúng ta đang làm có tên là RecipeBook.</p> <h3 id="clone-the-repository">Clone the Repository</h3> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="gp">$ </span>git clone ssh://192.123.99.7:29418/RecipeBook.git
Cloning into RecipeBook…</code></pre></figure> <h3 id="create-the-reviewer">Create the Reviewer</h3> <p>Những thay đổi bạn thực hiện được lưu trên local khả dụng để review khi thực hiện lệnh push vào Gerrit server.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="gp">$ </span>git commit -m “Create the Review”
<span class="gp">$ </span>git push origin HEAD:refs/for/master                                                  
Counting objects: 6, <span class="k">done</span>.
Delta compression using up to 8 threads.
Compressing objects: 100% <span class="o">(</span>6/6<span class="o">)</span>, <span class="k">done</span>.
Writing objects: 100% <span class="o">(</span>6/6<span class="o">)</span>, 596 bytes | 0 bytes/s, <span class="k">done</span>.
Total 6 <span class="o">(</span>delta 4<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>
remote: Resolving deltas: 100% <span class="o">(</span>4/4<span class="o">)</span>
remote: Processing changes: new: 1, refs: 1, <span class="k">done    
</span>remote: 
remote: New Changes:
remote:   http://192.123.99.7:8000/1128 Create the Review
remote: 
To ssh://tamtv@192.123.99.7:29418/RecipeBook.git
<span class="k">*</span> <span class="o">[</span>new branch]      HEAD -&gt; refs/for/master</code></pre></figure> <p>Tương ứng mỗi branch trên Authoritative repository có một branch tương ứng refs/for/<branch_name> trên Gerrit server mà bạn push lên để tạo ra một review.</branch_name></p> <h3 id="review-the-change">Review the Change</h3> <p>Work-flow mặc định của Gerrit yêu cầu 2 bước kiểm tra trước khi một commit được chấp nhận. Code-review là một ai đó nhìn vào code, để xem code đó có phù hợp với các tiêu chuẩn như project guideline, intent,.. Verifying là để kỉêm tra rằng sự thay đổi này có thể build đư ợc hay không, có thể pass các test case hay không.</p> <p>Verification thường được thực hịên bởi một server build tự động. Gerrit Triggers Jenkins Plugin sẽ tự động build mỗi khi có thay đổi và cập nhật điểm verified theo đó.</p> <p>Reviewer có thể download commit từ Gerrit server về local bằng 1 trong 2 cách: checkout hoặc cherry-pick.</p> <p>Các vote của một commit bao gồm: -2, -1, 0, 1, 2. -1, +1 chỉ là các ý kiến. -2, +2 là chấp nhận hoặc block commit này. Để một commit được chấp nhận, phải có ít nhất 1 vote +2 và không có vote -2 nào. 2 vote +1 không tương đương với 1 vote +2.</p> <p>Trong trư ờng hợp commit không đư ợc chấp nhận, người push commit lên phải thực hiện rework.</p> <h3 id="reworking-the-change">Reworking the Change</h3> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="gp">$ </span>&lt;checkout first commit&gt;
<span class="gp">$ </span>&lt;rework&gt;
<span class="gp">$ </span>git commit --amend
<span class="gp">$ </span>git push origin HEAD:refs/for/master
Counting objects: 5, <span class="k">done</span>.
Delta compression using up to 8 threads.
Compressing objects: 100% <span class="o">(</span>2/2<span class="o">)</span>, <span class="k">done</span>.
Writing objects: 100% <span class="o">(</span>3/3<span class="o">)</span>, 546 bytes, <span class="k">done</span>.
Total 3 <span class="o">(</span>delta 0<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>
remote: Processing changes: updated: 1, <span class="k">done
</span>remote:
remote: Updated Changes:
remote:   http://192.123.99.7:8000/1128
remote:
To ssh://tamtv@192.123.99.7:29418/RecipeBook.git
 <span class="k">*</span> <span class="o">[</span>new branch]      HEAD -&gt; refs/for/master
 </code></pre></figure> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://redsiren204.github.io/tags/#Gerrit" title="Pages tagged Gerrit" class="tag"><span class="term">Gerrit</span></a><a href="https://redsiren204.github.io/tags/#review" title="Pages tagged review" class="tag"><span class="term">review</span></a><a href="https://redsiren204.github.io/tags/#introduction" title="Pages tagged introduction" class="tag"><span class="term">introduction</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://redsiren204.github.io/gerrit-code-review-introduction/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=https://redsiren204.github.io/gerrit-code-review-introduction/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://redsiren204.github.io/gerrit-code-review-introduction/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="https://redsiren204.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://redsiren204.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://redsiren204.github.io/assets/js/jquery.goup.min.js"></script> <script src="https://redsiren204.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://redsiren204.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://redsiren204.github.io/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'taylantatli'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
